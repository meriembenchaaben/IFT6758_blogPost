---
layout: post
title: MileStone 2
---


## Task 2: Feature Engineering I

### Question 1

Figure 2.1 depicts the histogram of shot counts (goals and no-goals separated), binned by distance.

<figure> 
<img src="/assets/milestone2/2-shots-per-distance.png" alt="" style="margin:auto;">
<figcaption style="text-align:center;">Figure 2.1: Histogram of shot counts (goals and no-goals separated), binned by distance</figcaption>
</figure>

We clearly notice high count of shots and goals for lower distances.
Players tend to shot/score from distances close to the net and it is rare to see shots/goals from the defense zone of the team to the net of the opposing team.
Also, goals are more probable for lower distances close to the net.


Figure 2.2 shows the histogram of shot counts (goals and no-goals separated), binned by angle.

<figure> 
<img src="/assets/milestone2/2-shots-per-angle.png" alt="" style="margin:auto;">
<figcaption style="text-align:center;">Figure 2.2: Histogram of shot counts (goals and no-goals separated), binned by angle</figcaption>
</figure>

We see from that figure that players tend to shot and score when they are straight ahead the net (90°) and it is less frequent to score from lower or higher angles since it is difficult to score in these cases when we are not straight ahead the net.



Figure 2.3 depicts two plots that represent 2D histogram of shot counts (goals and no-goals separated) binned by distance and angle.

<figure> 
<img src="/assets/milestone2/2-shots-per-distance-angle-1.png" alt="" style="margin:auto;float:right; width:50%; padding:5px;">
<img src="/assets/milestone2/2-shots-per-distance-angle-2.png" alt="" style="margin:auto;float:right; width:50%; padding:5px;">
<figcaption style="text-align:center;">Figure 2.3:  2D histogram of shot counts (goals and no-goals separated) binned by distance and angle</figcaption>
</figure>

It is more often to shot when players are straight ahead and close to the net.
It is rare to shot from higher distances or from behind the net.


### Question 2

Figure 2.4 shows the goal rate per distance.

<figure> 
<img src="/assets/milestone2/2-goals-rate-distance-1.png" alt="" style="margin:auto;float:right; width:50%; padding:5px;">
<img src="/assets/milestone2/2-goals-rate-distance-2.png" alt="" style="margin:auto;float:right; width:50%; padding:5px;">
<figcaption style="text-align:center;">Figure 2.4: Goal rate per distance</figcaption>
</figure>

This figure confirms previous observations.
We have higher goal rates for lower distances.
Players have more success rate when they are close to the net.

Figure 2.4 shows the goal rate per angle.

<figure> 
<img src="/assets/milestone2/2-goals-rate-angle-1.png" alt="" style="margin:auto;float:right; width:50%; padding:5px;">
<img src="/assets/milestone2/2-goals-rate-angle-2.png" alt="" style="margin:auto;float:right; width:50%; padding:5px;">
<figcaption style="text-align:center;">Figure 2.5: Goal rate per angle</figcaption>
</figure>

This figure affirms our previous findings.
We have high goal rate when they are straight ahead the net (90°) and it is more difficult to score from bigger and lower angles.


### Question 3
<figure> 
<img src="/assets/milestone2/2-goals-distance-net.png" alt="" style="margin:auto;">
<figcaption style="text-align:center;">Figure 2.6: Goals count binned by distance for empty and non-empty net events</figcaption>
</figure>









## Task 3: Baseline Models

Apart from the test set, we splitted the rest of the data, resulted from **Feature Engineering I**, into train and validation sets: *20%* validation set and *80%* training set.
Table 3.1 describes the size of the different dataset splits.

| Dataset size        | 311086 |
| Training set size   | 248868 |
| Validation set size | 62218  |

<dev style="display:block;text-align:center;">Table 3.1: Dataset information </dev>

### Question 1
We trained a *Logistic Regression* classifier on the distance feature only, and we evaluated its accuracy (i.e., correctly predicted / total) on the validation set. 
The accuracy of our model during training is **0.9063** and its accuracy on the validation set is **0.9058**.
We looked at the predictions of our model and we noticed that it is always predicting **0**. this means that the model is always predicting a shot (i.e., non-goal ) for all the observations.
To investigate the potential reasons behind this issue, we computed the goal rate in the dataset given by the following formula:

> Goal rate = Count of goals / Count of shots and goals

Equivalently,
> Non-Goal rate = Count of shots / Count of shots and goals    

where: *Non-goals = Shots*

Table 3.2 depicts the goal rate in the different datasets.

| Dataset        | Goal rate | Non-Goal rate |
|----------------|------------|----------------|
| ALL dataset    | 0.0938     | 0.9062         |
| Training set   | 0.0937     | 0.9063         |
| Validation set | 0.0942     | 0.9058         |

<dev style="display:block;text-align:center;">Table 3.2: Goal/non-goal rates for the different datasets </dev>

This table helps us figuring out the potential issue.
In fact, the dataset is imbalanced. We have more than **90%** of the data is shots (i.e. non-goals).
So, the model is always predicting *non-goal* for all the events and we obtain **90%** as accuracy which is not relevant and not representative of the performance of our model since we are interested in expected goals (i.e. the probanility that a shot is a goal) and we aim that our model predicts well if an event could result in a goal.
Currently, we have the *accuracy* equal to the *non-goal rate* since our model is always predicting 0.
However, to have a fair and more significant evaluation, we should explore further the performance of our model using other metrics and plots.


### Question 2 & 3

Figure 3.1 depicts the ROC curves for the different classifiers and Table 3.3 illustrates the AUC metric of ROC for these models.

<figure> 
<img src="/assets/milestone2/3-roc.png" alt="" style="margin:auto;">
<figcaption style="text-align:center;">Figure 3.1: ROC (Receiver Operating Characteristic) curve of the different classifiers</figcaption>
</figure>

| Classifier                                  | AUC of ROC |
|---------------------------------------------|:----------:|
| Logistic Regression (distance)              | 0.685      |
| Logistic Regression (angle)                 | 0.507      |
| Logistic Regression (angle+distance)        | 0.685      |
| Random baseline with uniform distribution   | 0.5        |

The ROC curve shows the diagnostic ability of binary classifiers. It depicts the true positive rate (i.e. sensitivity) against the false positive rate (i.e. 1 - specificity).
The curves of *LR(distance)* and *LR(distance+angle)* are identical which means that the *LR* classifier relies more on the *distance* feature and considers it as a more important feature as compared to the *angle* feature. 
This actually makes sense in terms of ROC curve and AUC metric as we clearly see that the *LR(angle)* classifier has worse *AUC* score and its *ROC* curve is below the other curves which means it is performing worse in predicting expected goals.
Compared to the *Random baseline*, the *LR(angle)* classifier has a comparable value 
For some threshold values, the ROC curve of *LR(angle)* is below that of the random classifier.
Eventhough *LR(distance)* and *LR(distance+angle)* have the *ROC* curve above that of the random baseline, their performance is not good enough as they have poor value of *AUC* (far from 1).

*ROC* curves are also useful to determine a *cutoff value* for predicting expected goals.
This would definitely help improving the performance of the classifiers compared to the case where we use *0.5* as a *cutoff* value. 
This would improve the predictions of expected goals using our models.
We tried using the optimal cutoff point that maximizes the difference *True Positive Rate - False Positive Rate)*.
This allowed us to solve the problem of predicting all the events as non-goals and gave better predictions.


Table 3.5 shows the optimal cutoff points obtained from the ROC curve (code available in `notebooks/3-BaselineModels.ipynb`).
This threshold is obtained based on the maximization of the difference **True Positive Rate - False Positive Rate)**.


| Classifier                                  | Optimal cutoff point |
|---------------------------------------------|:--------------------:|
| Logistic Regression (distance)              | 0.09618              |
| Logistic Regression (angle)                 | 0.09333              |
| Logistic Regression (angle+distance)        | 0.09634              |

<dev style="display:block;text-align:center;">Table 3.5:  Best cutoff point for the different LR models</dev>


Figure 3.2 shows the goal rate by shot probability model percentile.

<figure> 
<img src="/assets/milestone2/3-goal_rate_percentile_1.png" alt="" style="margin:auto;">
<figcaption style="text-align:center;">Figure 3.2: Goal rate by shot probability model percentile</figcaption>
</figure>





<figure> 
<img src="/assets/milestone2/3-goal_rate_percentile_2.png" alt="" style="margin:auto;">
<figcaption style="text-align:center;">Figure 3.3: Cumulative proportion of goals by shot probability model percentile</figcaption>
</figure>

<figure> 
<img src="/assets/milestone2/3-calibration_diagram.png" alt="" style="margin:auto;">
<figcaption style="text-align:center;">Figure 3.4: Reliability diagram (calibration curve)</figcaption>
</figure>


### Question 4

- Links to experiments in *comet.ml*:
    - [Link to the experiment of dataset statistics in comet.ml](https://www.comet.ml/meriembchaaben/ift6758/b65854538ffd4dddaf1378a9679e23f1)
    - [Link to experiments of Logistic Regression (distance) in comet.ml ](https://www.comet.ml/meriembchaaben/ift6758/fbea37d0aa6d46a488c82cb6fe912fb0)
    - [Link to experiments of Logistic Regression (angle) in comet.ml ](https://www.comet.ml/meriembchaaben/ift6758/a0a1675d0895408faf2f476f91cf6e89)

- Links to registered models
    - [Link to Logistic Regression (distance) model in comet.ml ](https://www.comet.ml/meriembchaaben/model-registry/lr-distance-model)
    - [Link to Logistic Regression (angle) model in comet.ml ](https://www.comet.ml/meriembchaaben/model-registry/lr-angle-model)
    - [Link to Logistic Regression (distance+angle) model in comet.ml ](https://www.comet.ml/meriembchaaben/model-registry/lr-distance-angle-model)
    




## Task 4: Feature Engineering II

## Task 5: Advanced Models

## Task 6: Give it your best shot! 

## Task 7: Evaluate on test set

